package{	import flash.events.Event;  import flash.display.*;  import flash.geom.Point;  import flash.geom.Rectangle;  import flash.geom.Matrix;  import flash.utils.getTimer;  import com.friendsofed.utils.*;  import com.friendsofed.vector.*;  import com.friendsofed.gameElements.primitives.*;  [SWF(width="640", height="512",   backgroundColor="#FFFFFF", frameRate="60")]  	public class PlatformCollision extends Sprite	{	  private const MAX_TILE_SIZE:uint = 64;	  private const MAP_COLUMNS:uint = 10;	  private const MAP_ROWS:uint = 8;	  	  //tile images codes in tile sheet	  private const PLATFORM:uint = 00;	  private const SKY:uint = 10;	  private const CAT:uint = 20;	  	  private var _platformTiles:Array = [];	 	  private var _platformMap:Array	    = [	        [10,10,10,10,10,10,10,10,10,10],	        [00,00,10,10,10,10,10,10,10,10],	        [10,10,10,10,10,00,00,00,00,10],	        [10,10,00,10,10,10,10,10,10,10],	        [10,10,10,10,10,10,10,10,10,10],	        [00,00,00,00,10,10,10,00,10,10],	        [00,00,00,00,00,10,10,10,10,10],	        [00,00,00,00,00,00,00,00,00,00]	      ]    	      	  private var _gameObjectMap:Array      = [          [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],          [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],          [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],          [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],          [-1,-1,-1,-1,-1,20,-1,-1,-1,-1],          [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],          [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],          [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],        ]  	  //Create blank BitmapData objects as the canvas for this bitmap	  //They are in two layers: background for static objects	  //like the scenery, and forground for moving objects    private var _backgroundBitmapData:BitmapData       = new BitmapData(stage.stageWidth, stage.stageHeight, true, 0);    private var _backgroundBitmap:Bitmap       = new Bitmap(_backgroundBitmapData);    private var _foregroundBitmapData:BitmapData       = new BitmapData(stage.stageWidth, stage.stageHeight, true, 0);    private var _foregroundBitmap:Bitmap       = new Bitmap(_foregroundBitmapData);  	  	//Tile sheet  	//Variables required to display the tile sheet bitmap		[Embed(source="../../images/platformTileSheet.png")]    private var TileSheet:Class;		private var _tileSheetImage:DisplayObject = new TileSheet();		private var _tileSheetBitmapData:BitmapData 		  = new BitmapData			  (			    _tileSheetImage.width, 			    _tileSheetImage.height, 			    true, 			    0			  );        //Create a TileModel to represent the cat    private var _catModel:TileModel;    private var _UIPlatformController:UIPlatformController;    private var _UIPlatformView:UIPlatformView;		  		//Create a collision Controller to handle the collision		//between the player and the platforms		//You'll find the TileCollisionController in the		//com.friendsofed.utils package		private var _collisionController:TileCollisionController		 = new TileCollisionController();          //Status box  	private var _statusBox:StatusBox = new StatusBox;				public function PlatformCollision():void		{  		  //Draw the BitmapData objects			//_catBitmapData.draw(_catImage);			_tileSheetBitmapData.draw(_tileSheetImage);					  //Add the stage bitmap		  //this displays the contents of the _backgroundBitmapData		  //It will be updated automatically when		  //the _backgroundBitmapData is changed			addChild(_backgroundBitmap);			addChild(_foregroundBitmap);						//Add the status box			addChild(_statusBox);						//Run the buildMap method to convert the			//map array data into a visual display			buildMap(_platformMap);			buildMap(_gameObjectMap);				addEventListener(Event.ENTER_FRAME, enterFrameHandler);		}				//Create tile Models and map them to the		//correct positions on the tile sheet		private function buildMap(map:Array):void	  {    for(var mapColumn:int = 0; mapColumn < MAP_COLUMNS; mapColumn++)    {      for(var mapRow:int = 0; mapRow < MAP_ROWS; mapRow++)      {        var currentTile:int = map[mapRow][mapColumn];                if(currentTile > -1)        {          var tileSheetCoordinates:String = currentTile.toString();          var tileSheetColumn:uint             = uint(tileSheetCoordinates.charAt(0));          var tileSheetRow:uint             = uint(tileSheetCoordinates.charAt(1));                      if(currentTile == CAT)          {            //TileModel(tilesheetColumn, tilesheetRow,             //destinationRow, destinationColumn,             //width, height, tileSheetIndexNumber)            _catModel  	          = new TileModel  	          (  	            tileSheetColumn, tileSheetRow,   	            mapRow, mapColumn,   	            48, 42,  	            mapColumn * MAX_TILE_SIZE, mapRow * MAX_TILE_SIZE  	          );   	        _catModel.gravity_Vy = 0.98;  	          	        //Add the UIView and UIController    	        _UIPlatformController  	          = new UIPlatformController(_catModel);	          _UIPlatformView		          = new UIPlatformView		          (_catModel, _UIPlatformController, stage);  		            	        drawGameObject(_catModel, _foregroundBitmapData)          }                    if(currentTile == PLATFORM)          {            var platform:TileModel               = new TileModel              (                tileSheetColumn, tileSheetRow,   	            mapRow, mapColumn,   	            MAX_TILE_SIZE, MAX_TILE_SIZE,  	            mapColumn * MAX_TILE_SIZE, mapRow * MAX_TILE_SIZE              );            _platformTiles.push(platform);    	        drawGameObject(platform, _backgroundBitmapData);          }                    if(currentTile == SKY)          {            var sky:TileModel               = new TileModel              (                tileSheetColumn, tileSheetRow,   	            mapRow, mapColumn,   	            MAX_TILE_SIZE, MAX_TILE_SIZE,  	            mapColumn * MAX_TILE_SIZE, mapRow * MAX_TILE_SIZE              );  	        drawGameObject(sky, _backgroundBitmapData)          }        }      }    }   }				private function enterFrameHandler(event:Event):void		{ 		  //Update the cat's Model		  _catModel.update();		  		  //Stop the cat at the stage boundaries		  StageBoundaries.stopBitmap(_catModel, stage); 		  		  //Clear the stage bitmap from the previous frame so that it's		  //blank when you add the new tile positions		  _foregroundBitmapData.fillRect(_foregroundBitmapData.rect, 0);		  		  for(var i:int = 0; i < _platformTiles.length; i++)      {        _collisionController.playerVsPlatform          (_catModel, _platformTiles[i]);      }        		  //Blit the cat on the foreground bitmap		  drawGameObject(_catModel, _foregroundBitmapData);		  		  //Update status box			_statusBox.text = "PLATFORM COLLISION:"; 			_statusBox.text 			  += "\n" + "PLATFORM TILES: " + _platformTiles.length;			_statusBox.text 			  += "\n" + "CAT JUMPING: " + _catModel.jumping;  					 }				private function drawGameObject		  (		    tileModel:TileModel, 		    screen:BitmapData		  ):void		{		  var sourceRectangle:Rectangle = new Rectangle  			(  		    tileModel.tileSheetColumn * MAX_TILE_SIZE,   			  tileModel.tileSheetRow * MAX_TILE_SIZE,   			  tileModel.width,   			  tileModel.height  			);					  	  var destinationPoint:Point = new Point      (        tileModel.xPos,         tileModel.yPos      );            screen.copyPixels        (          _tileSheetBitmapData,           sourceRectangle,           destinationPoint,          null, null, true        );	  }	}}