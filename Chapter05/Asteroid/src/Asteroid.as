package{	import flash.events.Event;  import flash.display.*;  import flash.geom.Point;  import com.friendsofed.utils.*;  import com.friendsofed.gameElements.lunarLander.*;  import com.friendsofed.gameElements.primitives.*;  import com.friendsofed.vector.*;  [SWF(width="550", height="400", backgroundColor="#FFFFFF", frameRate="60")]  	public class Asteroid extends Sprite	{			//Create the lander and add its UI controller  		private var _lander:LanderModel   		  = new LanderModel(30,30);  		private var _landerUIController:LanderUIController   		  = new LanderUIController(_lander);  		private var _lander_View:LanderView   		  = new LanderView(_lander);  		private var _landerUIView:LanderUIView   		  = new LanderUIView(_lander, _landerUIController, stage);						//Distance vector			private var _v0:VectorModel = new VectorModel();			private var _v0_View:VectorView = new VectorView(_v0);						//Status box  		private var _statusBox:StatusBox = new StatusBox;						//Variables required to display the asteroid bitmap			private var _asteroidBitmap:Bitmap;			private var _asteroidBitmapData:BitmapData;						//1. Embed the image of the asteroid. Use a relative path.      //Create a class to store the image      [Embed(source="../assets/images/asteroid.png")]      private var AsteroidImage:Class;				public function Asteroid():void		{ 		  //Add the lander to the stage			addChild(_lander_View);			_lander.setX = 250;			_lander.setY = 50;						//Add the vector View			addChild(_v0_View);						//Add gravity			_lander.gravity_Vy = 0.1;						//2. Create a new instance of the AsteroidImage class			var asteroidImage:DisplayObject = new AsteroidImage();						//3. Create a BitmapData object to map the image.			//You must include "true" and "0" in the constructor for 			//the PNG's transparency 			_asteroidBitmapData 			  = new BitmapData			  (			    asteroidImage.width, 			    asteroidImage.height, 			    true, 			    0			  );			_asteroidBitmapData.draw(asteroidImage);						//4. Create and add the asteroid Bitmap			_asteroidBitmap = new Bitmap(_asteroidBitmapData);			addChild(_asteroidBitmap);			_asteroidBitmap.x = 200;			_asteroidBitmap.y = 100;						//Add the status box			addChild(_statusBox);						addEventListener(Event.ENTER_FRAME, enterFrameHandler);		}				private function enterFrameHandler(event:Event):void		{ 						//Update the lander			_lander.update();			StageBoundaries.wrapBitmap(_lander, stage); 						//Create the lander's Bitmap and Bitmap data objects			var landerBitmap:Object = createBitmap(_lander, _lander_View);						//The distance vector between the lander and the asteroid			_v0.update			  (			    _lander.xPos + _lander.width * 0.5, 			    _lander.yPos + _lander.height * 0.5, 			    _asteroidBitmap.x + _asteroidBitmap.width * 0.5, 			    _asteroidBitmap.y + _asteroidBitmap.height * 0.5			  );						//Check for a collision			var loopCounter:int = 0;		  while (loopCounter++ != 10) 		  {			  if(landerBitmap.bitmapData.hitTest			      (			        new Point(_lander.xPos, _lander.yPos), 			        255, 			        _asteroidBitmap,			        new Point(_asteroidBitmap.x, _asteroidBitmap.y),			        255			      )			    )			  {			    //Switch off gravity			 	  _lander.gravity_Vy = 0;			 	  			 	  //Move the lander out of the collision in the direction			 	  //of the distance vector.			 	  _lander.setX = _lander.xPos - _v0.dx;			    _lander.setY = _lander.yPos - _v0.dy;			    _lander.vx = 0;			    _lander.vy = 0;		      			  } 			  else 			  {			    break;			  }		  }		  		  //Switch gravity back on if there is no ground below the lander		  //Adding "+1" to the _lander's y position 		  //is the key to making this work		  //It extends the area that's sensitive 		  //to the collision by one pixel		  //below the lander. This allows it to "see" 		  //whether or not it's touching the ground.		  		  if(!landerBitmap.bitmapData.hitTest		      (		        new Point(_lander.xPos, _lander.yPos + 1), 			      255, 			      _asteroidBitmap,			      new Point(_asteroidBitmap.x, _asteroidBitmap.y),			      255			    )			  )			{			  _lander.gravity_Vy = 0.1;		  }		        //Update status box			_statusBox.text = "ASTEROID:";   			_statusBox.text += "\n" + "GRAVITY: " + _lander.gravity_Vy;   		}		private function createBitmap		  (model:AVerletModel, view:AVerletView):Object		{		  //Create the BitmapData and Bitmap objects 		  //based on the Lander’s Model and View         			var bitmapData:BitmapData 			  = new BitmapData(model.width, model.height, true, 0);			bitmapData.draw(view);			var bitmap:Bitmap = new Bitmap(bitmapData);						//Create the object to return to the caller			var bitmapObject:Object = new Object;			bitmapObject.bitmapData = bitmapData;			bitmapObject.bitmap = bitmap;						return bitmapObject;		}	}}